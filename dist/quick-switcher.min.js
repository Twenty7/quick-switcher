/**
 * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/almond/LICENSE
 */

!function(e,t){"function"==typeof define&&define.amd?define([],t):e.lstrQuickSwitcher=t()}(this,function(){var e,t,s;return function(i){function r(e,t){return C.call(e,t)}function l(e,t){var s,i,r,l,n,c,a,o,h,u,d,f,m=t&&t.split("/"),p=g.map,v=p&&p["*"]||{};if(e){for(e=e.split("/"),n=e.length-1,g.nodeIdCompat&&S.test(e[n])&&(e[n]=e[n].replace(S,"")),"."===e[0].charAt(0)&&m&&(f=m.slice(0,m.length-1),e=f.concat(e)),h=0;h<e.length;h++)if(d=e[h],"."===d)e.splice(h,1),h-=1;else if(".."===d){if(0===h||1===h&&".."===e[2]||".."===e[h-1])continue;h>0&&(e.splice(h-1,2),h-=2)}e=e.join("/")}if((m||v)&&p){for(s=e.split("/"),h=s.length;h>0;h-=1){if(i=s.slice(0,h).join("/"),m)for(u=m.length;u>0;u-=1)if(r=p[m.slice(0,u).join("/")],r&&(r=r[i])){l=r,c=h;break}if(l)break;!a&&v&&v[i]&&(a=v[i],o=h)}!l&&a&&(l=a,c=o),l&&(s.splice(0,c,l),e=s.join("/"))}return e}function n(e,t){return function(){var s=x.call(arguments,0);return"string"!=typeof s[0]&&1===s.length&&s.push(null),m.apply(i,s.concat([e,t]))}}function c(e){return function(t){return l(t,e)}}function a(e){return function(t){b[e]=t}}function o(e){if(r(w,e)){var t=w[e];delete w[e],k[e]=!0,f.apply(i,t)}if(!r(b,e)&&!r(k,e))throw new Error("No "+e);return b[e]}function h(e){var t,s=e?e.indexOf("!"):-1;return s>-1&&(t=e.substring(0,s),e=e.substring(s+1,e.length)),[t,e]}function u(e){return e?h(e):[]}function d(e){return function(){return g&&g.config&&g.config[e]||{}}}var f,m,p,v,b={},w={},g={},k={},C=Object.prototype.hasOwnProperty,x=[].slice,S=/\.js$/;p=function(e,t){var s,i=h(e),r=i[0],n=t[1];return e=i[1],r&&(r=l(r,n),s=o(r)),r?e=s&&s.normalize?s.normalize(e,c(n)):l(e,n):(e=l(e,n),i=h(e),r=i[0],e=i[1],r&&(s=o(r))),{f:r?r+"!"+e:e,n:e,pr:r,p:s}},v={require:function(e){return n(e)},exports:function(e){var t=b[e];return"undefined"!=typeof t?t:b[e]={}},module:function(e){return{id:e,uri:"",exports:b[e],config:d(e)}}},f=function(e,t,s,l){var c,h,d,f,m,g,C,x=[],S=typeof s;if(l=l||e,g=u(l),"undefined"===S||"function"===S){for(t=!t.length&&s.length?["require","exports","module"]:t,m=0;m<t.length;m+=1)if(f=p(t[m],g),h=f.f,"require"===h)x[m]=v.require(e);else if("exports"===h)x[m]=v.exports(e),C=!0;else if("module"===h)c=x[m]=v.module(e);else if(r(b,h)||r(w,h)||r(k,h))x[m]=o(h);else{if(!f.p)throw new Error(e+" missing "+h);f.p.load(f.n,n(l,!0),a(h),{}),x[m]=b[h]}d=s?s.apply(b[e],x):void 0,e&&(c&&c.exports!==i&&c.exports!==b[e]?b[e]=c.exports:d===i&&C||(b[e]=d))}else e&&(b[e]=s)},e=t=m=function(e,t,s,r,l){if("string"==typeof e)return v[e]?v[e](t):o(p(e,u(t)).f);if(!e.splice){if(g=e,g.deps&&m(g.deps,g.callback),!t)return;t.splice?(e=t,t=s,s=null):e=i}return t=t||function(){},"function"==typeof s&&(s=r,r=l),r?f(i,e,t,s):setTimeout(function(){f(i,e,t,s)},4),m},m.config=function(e){return m(e)},e._defined=b,s=function(e,t,s){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(s=t,t=[]),r(b,e)||r(w,e)||(w[e]=[e,t,s])},s.amd={jQuery:!0}}(),s("../node_modules/almond/almond",function(){}),s("filters",[],function(){return{isFuzzyMatch:function(e,t){for(var s=0,i=0;s<e.length&&i<t.length;s++)for(;i<t.length&&(i++,e.charAt(s)!==t.charAt(i)););return i<t.length},areWordsFound:function(e,t){for(var s=e.split(/[^\w]/),i=0;i<s.length;i++)if(t.indexOf(s[i])===-1)return!1;return!0},isMatch:function(e,t){return t.indexOf(e)!==-1||!!this.areWordsFound(e,t)}}}),s("tracker",[],function(){var e=function(){return Math.floor((new Date).getTime()/1e3)};return{init:function(e){if(this.name=e,this.localStorageName="qswitcher-tracker-"+e,this.selections={},window.localStorage){var t=localStorage.getItem(this.localStorageName);t&&(this.selections=JSON.parse(t))}},trackSelection:function(t){if(t.trackerId){var s=t.trackerId;for(this.selections[s]||(this.selections[s]={count:0,timestamps:[]}),this.selections[s].timestamps.push(e()),++this.selections[s].count;this.selections[s].timestamps.length>10;)this.selections[s].timestamps.shift();this.save()}},sort:function(e){var t=this,s=0;return e.forEach(function(e){e._qswitcherOriginalOrder=s,e._qswitcherScore=t.scoreSelection(e),s++}),e.sort(function(e,t){return e._qswitcherScore==t._qswitcherScore?e._qswitcherOriginalOrder<t._qswitcherOriginalOrder?-1:1:e._qswitcherScore>t._qswitcherScore?-1:1}),e.forEach(function(e){delete e._qswitcherOriginalOrder}),e},save:function(){window.localStorage&&localStorage.setItem(this.localStorageName,JSON.stringify(this.selections))},scoreSelection:function(t){var s=this.selections[t.trackerId];if("undefined"==typeof s||!s.timestamps.length)return 0;var i=e(),r=s.timestamps.reduce(function(e,t){return t>i-14400?e+100:t>i-86400?e+80:t>i-259200?e+60:t>i-25200?e+40:t>i-108e3?e+20:t>i-324e3?e+10:e},0);return s.count*r/s.timestamps.length}}}),s("factories",["tracker"],function(e){var t={};return{tracker:function(s){if("undefined"!=typeof t[s])return t[s];var i=Object.create(e);return i.init(s),t[s]=i,t[s]}}}),s("selected-result",["factories"],function(e){return{init:function(e,t,s){this.selectedValue=e,this.searchText=t,this.domEvent=s},trackAs:function(t){e.tracker(t).trackSelection(this.selectedValue,this.searchText)}}}),s("sorters",["factories"],function(e){return{tracker:function(t){return e.tracker(t)}}}),s("quick-switcher",["filters","selected-result","sorters"],function(e,t,s){var i=jQuery,r={filters:e,sorters:s},l=function(e){return"function"==typeof e?e():e},n={init:function(e,t){this.$parentDom=null,this.$liCollection=null,this.valueObjects=null,this.selectedIndex=null,this.$results=null,this.$noSearchTerms=null,this.$noResults=null,this.$loading=null,this.$breadcrumb=null,this.$search=null,this.searchText="",this.searchDelayTimeout=null,this.searchId=0,this.modifierKey="ctrlKey",navigator.platform.toLowerCase().indexOf("mac")!=-1&&(this.modifierKey="metaKey"),t=i.extend({searchCallback:function(){},selectCallback:function(){},selectChildSearchCallback:function(){},searchDelay:1e3,hotKey:"K"},t),this.hotKey=t.hotKey.toUpperCase(),this.setOptions({searchCallback:t.searchCallback,selectCallback:t.selectCallback,selectChildSearchCallback:t.selectChildSearchCallback,searchDelay:t.searchDelay}),this.initDomElement(e),this.callbackStack=[],this.abortSearchCallback=null},initDomElement:function(e){var t=this;this.$parentDom=e,this.$domElement=i('<div class="lstr-qswitcher-overlay"></div><div class="lstr-qswitcher-container">  <form class="lstr-qswitcher-popup">    <div class="lstr-qswitcher-breadcrumb">    </div>    <div class="lstr-qswitcher-help">      <ul>        <li><em>&#8597;</em> to navigate</li>        <li><em>&#8629;</em> to select</li>        <li><em>&#9003;</em> to clear</li>        <li><em>esc</em> to dismiss</li>      </ul>    </div>    <input type="text" class="lstr-qswitcher-search form-control" />    <div class="lstr-qswitcher-loading">Loading...</div>    <div class="lstr-qswitcher-no-terms"></div>    <div class="lstr-qswitcher-no-results">No results found</div>    <div class="lstr-qswitcher-oops-results">      Oops! Something went wrong while trying to load your results.    </div>    <div class="lstr-qswitcher-results"></div>  </form></div>'),e.append(this.$domElement),this.$breadcrumb=this.$domElement.find(".lstr-qswitcher-breadcrumb"),this.$search=this.$domElement.find(".lstr-qswitcher-search"),this.$loading=this.$domElement.find(".lstr-qswitcher-loading"),this.$results=this.$domElement.find(".lstr-qswitcher-results"),this.$noSearchTerms=this.$domElement.find(".lstr-qswitcher-no-terms"),this.$noResults=this.$domElement.find(".lstr-qswitcher-no-results"),this.$oopsResults=this.$domElement.find(".lstr-qswitcher-oops-results");var s=this.$domElement;s.find(".lstr-qswitcher-popup").on("submit",function(e){e.preventDefault()}),e.find(".lstr-qswitcher-overlay").on("click",function(e){t.closeSwitcher(),e.preventDefault()}),e.on("keydown",function(e){var s=String.fromCharCode(e.which);e[t.modifierKey]&&s===t.hotKey&&(t.toggleSwitcher(),e.preventDefault())}),i("html").on("keydown",".lstr-qswitcher-noscroll",function(e){38===e.which?(t.selectIndex(t.selectedIndex-1),t.scrollToSelectedItem(),e.preventDefault()):40===e.which?(t.selectIndex(t.selectedIndex+1),t.scrollToSelectedItem(),e.preventDefault()):27===e.which?(t.toggleSwitcher(),e.preventDefault()):13===e.keyCode&&(t.triggerSelect(t.selectedIndex,e),e.preventDefault())}),this.$search.on("keyup",function(e){var s=t.$search.val();t.searchDelayTimeout&&(clearTimeout(t.searchDelayTimeout),t.searchDelayTimeout=null),s!==t.searchText?t.searchDelayTimeout=setTimeout(function(){t.selectIndex(null),t.searchText=s,t.renderList()},t.searchDelay):8===e.which&&""===s&&(t.popCallback(),t.renderList())}),s.on("hover",".lstr-qswitcher-results li",function(){var e=i(this);t.selectIndex(e.data("lstr-qswitcher").index)}),s.on("click",".lstr-qswitcher-results li",function(e){var s=i(this);t.triggerSelect(s.data("lstr-qswitcher").index,e)})},renderList:function(){this.abortSearchCallback&&(this.abortSearchCallback(),this.abortSearchCallback=null),this.renderBreadcrumb(),this.usePane(this.$loading);var e=Object.create(r);++this.searchId,e.setResults=this.setResults.bind(this,this.searchId),e.setError=this.setError.bind(this,this.searchId),this.abortSearchCallback=this.searchCallback(this.searchText,e)},setResults:function(e,t){if(e===this.searchId){var s=this;if(s.valueObjects=[],0==t.length)return this.$results.html(""),void this.usePane(this.searchText?this.$noResults:this.$noSearchTerms);var r=i("<ul>");t.forEach(function(e,t){var l=i("<li>"),n=i("<div>");if(r.append(l),l.append(n),s.setListText(n,e),e.description){var c=i('<span class="lstr-qswitcher-results-description"></span>');s.setListText(c,e.description),l.prepend(c)}l.data("lstr-qswitcher",{index:t}),n.addClass("lstr-qswitcher-result-container"),e.searchCallback&&l.addClass("lstr-qswitcher-result-category"),s.valueObjects[t]={index:t,value:e,$li:l}}),this.$results.html(r),this.usePane(this.$results),s.selectIndex(0)}},setError:function(e){e===this.searchId&&this.usePane(this.$oopsResults)},renderBreadcrumb:function(){var e=i("<ul>");this.callbackStack.forEach(function(t,s){var r=i("<li>");r.text(t.text),e.append(r)}),this.$breadcrumb.html(e)},setListText:function(e,t){return t.html?void e.html(l(t.html)):t.text?void e.html(l(t.text)):void e.text(t)},selectIndex:function(e){return null!==this.selectedIndex&&this.valueObjects[this.selectedIndex]&&this.valueObjects[this.selectedIndex].$li.removeClass("lstr-qswitcher-result-selected"),null===e||0===this.valueObjects.length?void(this.selectedIndex=null):(this.selectedIndex=e%this.valueObjects.length,this.selectedIndex<0&&(this.selectedIndex=this.valueObjects.length-1),void this.valueObjects[this.selectedIndex].$li.addClass("lstr-qswitcher-result-selected"))},scrollToSelectedItem:function(){if(null!==this.selectedIndex){var e=this.valueObjects[this.selectedIndex].$li,t=this.$results,s=e.offset().top-e.parent().offset().top,i=s+e.outerHeight(!0),r=t.scrollTop(),l=r+t.outerHeight(!0);(i>l||s<r)&&t.scrollTop(s)}},toggleSwitcher:function(){this.useRootCallback(),this.$search.val(""),this.searchText="",this.renderList(),this.$parentDom.toggleClass("lstr-qswitcher-noscroll"),this.$search.focus()},closeSwitcher:function(){this.$parentDom.removeClass("lstr-qswitcher-noscroll")},triggerSelect:function(e,s){if(null!==e){var i=this.valueObjects[e].value,r=Object.create(t);if(r.init(i,this.searchText,s),i.searchCallback){if(!1===this.selectChildSearchCallback(r))return;return this.callbackStack.push({text:i.breadcrumbText,parent:this.options}),this.options=i,this.searchCallback=i.searchCallback,i.searchDelay&&(this.searchDelay=i.searchDelay),i.selectCallback&&(this.selectCallback=i.selectCallback),i.selectChildSearchCallback&&(this.selectChildSearchCallback=i.selectChildSearchCallback),this.valueObjects=[],this.selectIndex(null),this.$search.val(""),this.searchText="",void this.renderList()}!1!==this.selectCallback(r)&&this.closeSwitcher()}},popCallback:function(){var e=this.callbackStack.pop();return!!e&&(this.setOptions(e.parent),!0)},useRootCallback:function(){for(;this.callbackStack.length>0;)this.popCallback()},usePane:function(e){this.$results.hide(),this.$noSearchTerms.hide(),this.$noResults.hide(),this.$oopsResults.hide(),this.$loading.hide(),e.show()},setOptions:function(e){this.options=e,this.searchCallback=e.searchCallback,this.searchDelay=e.searchDelay,this.selectCallback=e.selectCallback,this.selectChildSearchCallback=e.selectChildSearchCallback}};return lstrQuickSwitcher=function(e){var t=i("body"),s=Object.create(n);s.init(t,e)},lstrQuickSwitcher}),t("quick-switcher")});